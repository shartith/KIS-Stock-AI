# ë§¤ë§¤ ê·œì¹™ (Trading Rules)

ê±°ë˜ì†Œë³„ ì£¼ë¬¸ ë‹¨ìœ„, ì”ê³  ì œí•œ, ìë™ ë§¤ë§¤ ì œì–´ ê·œì¹™ì„ ì •ì˜í•©ë‹ˆë‹¤.

---

## 1. Lot Size (ì£¼ë¬¸ ë‹¨ìœ„)

ê±°ë˜ì†Œë³„ ìµœì†Œ ì£¼ë¬¸ ë‹¨ìœ„(Lot Size)ê°€ ë‹¤ë¥´ë©°, ë§¤ìˆ˜/ë§¤ë„ ì‹œ ìë™ ë³´ì •ë©ë‹ˆë‹¤.

| ê±°ë˜ì†Œ ì½”ë“œ | ì‹œì¥ | Lot Size | ì„¤ëª… |
|---|---|---|---|
| `TKSE` | ğŸ‡¯ğŸ‡µ ì¼ë³¸ | **100ì£¼** | 100ì£¼ ë‹¨ìœ„ ì£¼ë¬¸ |
| `SHAA` | ğŸ‡¨ğŸ‡³ ì¤‘êµ­ ìƒí•´ | **100ì£¼** | 100ì£¼ ë‹¨ìœ„ ì£¼ë¬¸ |
| `SZAA` | ğŸ‡¨ğŸ‡³ ì¤‘êµ­ ì‹¬ì²œ | **100ì£¼** | 100ì£¼ ë‹¨ìœ„ ì£¼ë¬¸ |
| `SEHK` | ğŸ‡­ğŸ‡° í™ì½© | **100ì£¼** | 100ì£¼ ë‹¨ìœ„ (ì¢…ëª©ë³„ ìƒì´) |
| ê¸°íƒ€ | ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ë“± | **1ì£¼** | 1ì£¼ ë‹¨ìœ„ ê°€ëŠ¥ |

### ë§¤ìˆ˜ ë¡œì§ (`_execute_buy`)

```python
# scanner_engine.py
LOT_SIZES = {
    "TKSE": 100, "SHAA": 100, "SZAA": 100, "SEHK": 100,
}
lot_size = LOT_SIZES.get(exchange, 1)

if lot_size > 1:
    # 1) ì˜¬ë¦¼ â†’ ìµœì†Œ lot_size ë³´ì¥
    qty_rounded = max(lot_size, ((qty + lot_size - 1) // lot_size) * lot_size)
    # 2) ì”ê³  ì´ˆê³¼ ì‹œ ë‚´ë¦¼
    if price * qty_rounded > avail_usd:
        qty_rounded = (qty // lot_size) * lot_size
    # 3) ìµœì†Œ ë‹¨ìœ„ë„ ë¶ˆê°€ ì‹œ ë§¤ìˆ˜ í¬ê¸°
    if price * qty_rounded > avail_usd:
        return  # ë§¤ìˆ˜ ë¶ˆê°€
    qty = qty_rounded
```

### ë§¤ë„ ë¡œì§ (`_execute_sell`)

```python
# ë‚´ë¦¼ìœ¼ë¡œ ì¡°ì • (ë³´ìœ ìˆ˜ëŸ‰ ì´ˆê³¼ ë°©ì§€)
qty = (qty // lot_size) * lot_size
if qty <= 0:
    return  # ìµœì†Œ ë‹¨ìœ„ ë¯¸ë§Œ â†’ ë§¤ë„ ë¶ˆê°€
```

### AI í”„ë¡¬í”„íŠ¸

AI ë§¤ìˆ˜ ì¶”ì²œ ì‹œ Lot Size ê°€ì´ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

```
- ì¼ë³¸/ì¤‘êµ­/í™ì½© ì£¼ì‹ì€ ë°˜ë“œì‹œ 100ì£¼ ë‹¨ìœ„ë¡œ ì¶”ì²œ (ìµœì†Œ 100ì£¼)
- ë¯¸êµ­ ì£¼ì‹ì€ 1ì£¼ ë‹¨ìœ„ ê°€ëŠ¥
- ìµœëŒ€ ì”ê³ ì˜ 30%
```

---

## 2. ì¥ ìš´ì˜ì‹œê°„ í•„í„°ë§

ì¥ì´ ë§ˆê°ëœ ì‹œì¥ì˜ Buy CandidateëŠ” ìë™ ì œê±°ë©ë‹ˆë‹¤.

### ì‹œì¥ ìš´ì˜ì‹œê°„ (KST ê¸°ì¤€)

| ì‹œì¥ | ì˜¤í”ˆ | ë§ˆê° |
|---|---|---|
| ğŸ‡°ğŸ‡· í•œêµ­ | 09:00 | 15:30 |
| ğŸ‡¯ğŸ‡µ ì¼ë³¸ | 09:00 | 15:00 |
| ğŸ‡¨ğŸ‡³ ì¤‘êµ­ | 10:00 | 16:00 |
| ğŸ‡­ğŸ‡° í™ì½© | 10:00 | 17:00 |
| ğŸ‡ºğŸ‡¸ ë¯¸êµ­ | 23:30 | 06:00 (ìµì¼) |

### í•„í„°ë§ ë¡œì§ (`_track_candidates`)

```python
# ë§¤ ë£¨í”„ë§ˆë‹¤ í™•ì¸
active_markets = self.get_active_markets()
self.candidates = [
    c for c in self.candidates
    if c.get("tracking_status") == "filled"     # ì²´ê²° ì™„ë£Œ â†’ ìœ ì§€
    or c.get("market", "US") in active_markets  # ì¥ ìš´ì˜ ì¤‘ â†’ ìœ ì§€
]
# ë¯¸ìš´ì˜ ì‹œì¥ í›„ë³´ â†’ ìë™ ì œê±° + ë¡œê·¸
```

---

## 3. ì˜ˆìˆ˜ê¸ˆ (Budget) ì œì•½

- AI ì¶”ì²œ ìˆ˜ëŸ‰ì´ ì˜ˆìˆ˜ê¸ˆì„ ì´ˆê³¼í•˜ë©´ ìë™ ì¡°ì •
- ìµœì†Œ Lot Size ê°€ê²©ì´ ì˜ˆìˆ˜ê¸ˆë³´ë‹¤ í¬ë©´ ë§¤ìˆ˜ ìŠ¤í‚µ
- ìŠ¤í‚µëœ ì¢…ëª© ìˆ˜ëŠ” `skipped_by_budget` ì¹´ìš´í„°ì— ê¸°ë¡
- ê°€ì¥ ì €ë ´í–ˆì§€ë§Œ ìŠ¤í‚µëœ ì¢…ëª©ì€ `cheapest_skipped`ì— ê¸°ë¡
